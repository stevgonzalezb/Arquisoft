
@{
    ViewBag.Title = "Reportes";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">

        </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="row">
            <div class="col-md-12 d-flex flex-column justify-content-center">
                <div class="card card-secondary">
                    <div class="card-header">
                        <h3 class="card-title">Reportes del Sistema</h3>

                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row col-12">
                            <div class="col-md-4">
                                <label for="inputEstimatedBudget">Proyectos por Cliente:</label>
                            </div>
                            <div class="col-md-4">
                                <select id="cmbClients" class="form-control select2bs4" style="width: 100%;">
                                </select>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-secondary" onclick="Generate_ProjectsByCustomer()">Generar</button>
                            </div>
                        </div>
                        <hr />
                        <div class="row col-12">
                            <div class="col-md-4">
                                <label for="inputEstimatedBudget">Materiales usados entre fechas:</label>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="far fa-calendar-alt"></i>
                                        </span>
                                    </div>
                                    <input type="text" class="range-datetime form-control float-right" id="materialsReportDates">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-secondary" onclick="Generate_UsedMaterials()">Generar</button>
                            </div>
                        </div>
                        <hr />
                        <div class="row col-12">
                            <div class="col-md-4">
                                <label for="inputEstimatedBudget">Presupuestos entre fechas:</label>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">
                                            <i class="far fa-calendar-alt"></i>
                                        </span>
                                    </div>
                                    <input type="text" class="range-datetime form-control float-right" id="budgetsReportDates">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-secondary" onclick="Generate_BudgetsCreated()">Generar</button>
                            </div>
                        </div>
                        <hr />
                    </div>
                    <!-- /.card-body -->
                </div>
            </div>
        </div>
    </section>
    <!-- /.content -->
</div>
<!-- /.content-wrapper -->
@*Modal Ayuda*@
<div class="modal" id="reportsModalAyuda" role="dialog">
    <div class="modal-dialog" style="overflow-y: initial !important">
        <div class="modal-content"  style="width: 50vw;">
            <div class="modal-header">
                <h4 class="text-bold text-center">Ayuda Proceso Generar Reportes</h4>
            </div>
            <div class="modal-body" align="center" style="height: 80vh; overflow-y: auto;">
                <h4 align="center"><b></b></h4>
                <p>&nbsp;&nbsp;Este módulo está desarrollado para generar varios tipos de reportes</p>

                @*Ayuda reportes*@

                <p>&nbsp;&nbsp;1- Selecciona el cliente del cual se requiere genera algún tipo de reporte.</p>
                <div class="modal-body" align="left">
                    <img src="~/Content/img/Help/Reports/Reports01.JPG" class="img-rounded" alt="Cinque Terre" />
                </div>
                <p>&nbsp;&nbsp;2- Se contará con 2 tipos de reportes.</p>
                <div class="modal-body" align="left">
                    <img src="~/Content/img/Help/Reports/Reports02.JPG" class="img-rounded" alt="Cinque Terre" />
                </div>
                <p>&nbsp;&nbsp; <b>1:</b>&nbsp;&nbsp;Materiales usuarios en los presupuestos generados al usuario, en un rango de fecha.</p>
                <p>&nbsp;&nbsp; <b>2:</b>&nbsp;&nbsp;Cantidad de presupuestos que se le han realizado al cliente, en un rango de fecha.</p>
                <p>&nbsp;&nbsp;3- Para ambos reportes, seleccione el rango de fecha del calendario que se despliega.</p>
                <div class="modal-body" align="left">
                    <img src="~/Content/img/Help/Reports/Reports03.JPG" class="img-rounded" alt="Cinque Terre" />
                </div>
                <p>&nbsp;&nbsp;3- Da clic al botón “Generar”</p>
                <div class="modal-body" align="left">
                    <img src="~/Content/img/Help/Reports/Reports04.JPG" class="img-rounded" alt="Cinque Terre" />
                </div>

                <br />
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>
</div>
@*/.modal*@


@section scripts{

    <!-- Select2 -->
    <script src="~/Scripts/AdminLTE/plugins/select2/js/select2.full.min.js"></script>
    <script src="~/Scripts/AdminLTE/plugins/moment/moment.min.js"></script>
    <!-- date-range-picker -->
    <script src="~/Scripts/AdminLTE/plugins/daterangepicker/daterangepicker.js"></script>

    <script>

        const apiClients = new ClientApi();

        $(document).ready(function () {

            //Date range picker
            $('.range-datetime').daterangepicker({
                locale: {
                    format: 'DD/MM/YYYY'
                }
            });
            $("#helpModalNav").attr('data-target', "#reportsModalAyuda");
            LoadClientList();

        });

        function LoadClientList() {
            apiClients.ListClients().then(clients => {
                var $ClientSelect = $('#cmbClients');
                $.each(clients.data, function (key, value) {

                    if (value.idState == '1') {
                        var $option = $("<option/>", {
                            value: value.IdClient,
                            text: `${value.Name} ${value.Last_Name}`
                        });
                    }


                    $ClientSelect.append($option);
                });
            })

        }

        function Generate_ProjectsByCustomer() {

            var cId = parseInt($("#cmbClients").val());
            window.open(`/ArquisoftApp/Report/_ProjectsByCustomer?cId=${cId}`, '_blank').focus();
        }

        function Generate_UsedMaterials() {

            var dates = $("#materialsReportDates").val();
            window.open(`/ArquisoftApp/Report/_UsedMaterials?dates=${dates}`, '_blank').focus();
        }

        function Generate_BudgetsCreated() {

            var dates = $("#budgetsReportDates").val();
            window.open(`/ArquisoftApp/Report/_BudgetsCreated?dates=${dates}`, '_blank').focus();
        }


    </script>


}